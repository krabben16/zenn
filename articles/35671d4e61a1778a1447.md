---
title: "Nuxt+TypeScriptç’°å¢ƒã§ç”»åƒã‚’é…å»¶èª­ã¿è¾¼ã¿ã™ã‚‹ï¼ˆIntersection Observerç·¨ï¼‰" # è¨˜äº‹ã®ã‚¿ã‚¤ãƒˆãƒ«
emoji: "ğŸˆ" # ã‚¢ã‚¤ã‚­ãƒ£ãƒƒãƒã¨ã—ã¦ä½¿ã‚ã‚Œã‚‹çµµæ–‡å­—ï¼ˆ1æ–‡å­—ã ã‘ï¼‰
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢è¨˜äº‹
topics: ["vue.js", "nuxt.js", "typescript"] # ã‚¿ã‚°ã€‚["markdown", "rust", "aws"]ã®ã‚ˆã†ã«æŒ‡å®šã™ã‚‹
published: false # å…¬é–‹è¨­å®šï¼ˆfalseã«ã™ã‚‹ã¨ä¸‹æ›¸ãï¼‰
---

# æ¦‚è¦

ä»¥ä¸‹ã®æ¤œè¨¼ç’°å¢ƒã§Intersection Observerã‚’ä½¿ã£ã¦ç”»åƒã‚’é…å»¶èª­ã¿è¾¼ã¿ã—ã¾ã™ã€‚

Vueè£½ã®Intersection Observerã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æä¾›ã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ ([vue-intersect](https://github.com/heavyy/vue-intersect)) ã¯ã™ã§ã«å­˜åœ¨ã—ã¾ã™ãŒã€ã“ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æ¤œè¨¼ç’°å¢ƒã§ä½¿ãŠã†ã¨ã—ãŸã¨ã“ã‚ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚

> SyntaxError Cannot use import statement outside a module

ã¾ãŸã€[ã“ã¡ã‚‰ã®è¨˜äº‹](https://zenn.dev/sengosha/articles/63a04ba5da5303e3993d) ã®å¯¾å¿œæ–¹æ³•ã‚’è©¦ã—ã¦ã¿ã¾ã—ãŸãŒä»¥ä¸‹ã®æ–°ãŸãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸãŸã‚ã€æ¤œè¨¼ç’°å¢ƒã§å‹•ä½œã™ã‚‹Intersection Observerã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸã€‚

> Error render function or template not defined in component: Intersect

# æ¤œè¨¼ç’°å¢ƒ

- package.json
  - nuxt v2.14.6
  - @nuxtjs/composition-api v0.15.0
  - @nuxt/typescript-build v2.0.3

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®ãƒªãƒã‚¸ãƒˆãƒªã«é…ç½®ã—ã¾ã—ãŸã€‚
[krabben16/sandbox-nuxt-intersection-observer](https://github.com/krabben16/sandbox-nuxt-intersection-observer)

# æŒ™å‹•ã«ã¤ã„ã¦

- é…å»¶èª­ã¿è¾¼ã¿ã•ã›ãŸã„è¦ç´ ã‚’Observerã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚¹ãƒ­ãƒƒãƒˆã«æ¸¡ã—ã¾ã™ã€‚ã‚µãƒ³ãƒ—ãƒ«ã§ã¯thresholdã« `[0.2, 0.8]` ã‚’è¨­å®šã—ã¦ãŠã‚Šã€ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆã¨ç”»åƒè¦ç´ ã®äº¤å·®ç‡ãŒ0.2ã¾ãŸã¯0.8ã‚’ä¸Šå›ã£ãŸã‚Šä¸‹å›ã£ãŸã‚Šã—ãŸã¨ãã« `onEnter` ã‚„ `onLeave` é–¢æ•°ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
- é…å»¶èª­ã¿è¾¼ã¿å‰ã¯srcå±æ€§ã«è¨­å®šã—ãŸãƒ€ãƒŸãƒ¼ç”»åƒãŒè¡¨ç¤ºã•ã‚Œã€`onEnter` ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§srcã®å€¤ã‚’data-srcã®å€¤ã§æ›¸ãæ›ãˆã¾ã™ã€‚
- rootã‚„rootMarginãªã©ã€thresholdä»¥å¤–ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¨­å®šã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚
- ã‚µãƒ³ãƒ—ãƒ«ã§ã¯imgã‚¿ã‚°ã‚’è¨˜è¿°ã—ã¾ã—ãŸãŒã€ä¾‹ãˆã°iframeã‚„divãªã©ã®è¦ç´ ã§ã‚ã£ã¦ã‚‚ç›£è¦–å¯¾è±¡ã«ã§ãã‚‹ã®ã§ã€Observerã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã«è¨­å®šã™ã‚‹é–¢æ•°ã‚’ç·¨é›†ã™ã‚Œã°ä»»æ„ã®å‡¦ç†ã‚’é…å»¶å®Ÿè¡Œã§ãã¾ã™ã€‚

```vue
<template>
  <Observer :threshold="[0.2, 0.8]" @enter="onEnter" @leave="onLeave" @change="onChange">
    <img ref="lazyImageRef" src="/images/dummy.png" :data-src="src" :height="height" :width="width" :alt="alt" :title="title" />
  </Observer>
</template>

<script lang="ts">
import { defineComponent, ref } from '@nuxtjs/composition-api'
// TODO: Polyfill

export default defineComponent({
  props: {
    src: {
      type: String,
      required: true,
    },
    height: {
      type: String,
      required: false,
    },
    width: {
      type: String,
      required: false,
    },
    alt: {
      type: String,
      required: false,
    },
    title: {
      type: String,
      required: false,
    },
  },
  setup() {
    const lazyImageRef = ref<HTMLImageElement>()
    return {
      lazyImageRef,
    }
  },
  methods: {
    onEnter() {
      if (!this.lazyImageRef) return
      console.log('onEnter')

      if (this.lazyImageRef.dataset.src) {
        this.lazyImageRef.src = this.lazyImageRef.dataset.src
        delete this.lazyImageRef.dataset.src
      }
    },
    onLeave() {
      console.log('onLeave')
    },
    onChange() {
      console.log('onChange')
    }
  }
})
</script>
```

# ãƒ‡ãƒ¢

- [é…å»¶èª­ã¿è¾¼ã¿ãªã—](https://test-nuxt-intersection-observer.netlify.app/)
- [é…å»¶èª­ã¿è¾¼ã¿ã‚ã‚Š](https://test-nuxt-intersection-observer.netlify.app/observer)

# è£œè¶³: IEå¯¾å¿œã«ã¤ã„ã¦

Intersection Obserber APIã¯IEã§å¯¾å¿œã•ã‚Œã¦ã„ãªã„ã®ã§åˆ©ç”¨ã™ã‚‹éš›ã¯Polyfillã‚’å°å…¥ã—ã¦ãã ã•ã„ã€‚

- å‚è€ƒ
  - [JSã§ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é€£å‹•ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã«ã¯Intersection ObserverãŒä¾¿åˆ©](https://ics.media/entry/190902/)
  - [w3c/IntersectionObserver](https://github.com/w3c/IntersectionObserver/tree/master/polyfill)

# è£œè¶³: nuxt/imageã«ã¤ã„ã¦

ã“ã®è¨˜äº‹ã‚’ä½œæˆã—ãŸã‚ã¨ã«çŸ¥ã£ãŸã®ã§ã™ãŒã€Nuxtå‘ã‘ã«æœ€é©åŒ–ã•ã‚ŒãŸç”»åƒã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æä¾›ã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦ [nuxt/image](https://github.com/nuxt/image) ãŒã‚ã‚Šã¾ã™ã€‚

ä¸»ãªç‰¹å¾´ã¨ã—ã¦ã€Œé…å»¶èª­ã¿è¾¼ã¿ã€ã€Œå®Œå…¨ãªé™çš„ã‚µãƒãƒ¼ãƒˆã€ã€ŒCDNã‚µãƒãƒ¼ãƒˆã€ã‚’å‚™ãˆã¦ã„ã¾ã™ã€‚ã¾ãŸã€ã“ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã™ã‚‹ã¨Nuxtã¯ç”»åƒã®ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã‚’è‡ªå‹•çš„ã«è¨ˆç®—ã—ã€ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã«åŸºã¥ã„ã¦ç”»åƒã®ã‚µã‚¤ã‚ºã‚’è¨­å®šã—ã¾ã™ã€‚ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã‚’ç¶­æŒã™ã‚‹ã‚ˆã†ã«ç”»åƒã‚’å¼·åˆ¶ã™ã‚‹ã¨ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®ã‚·ãƒ•ãƒˆãŒé˜²æ­¢ã•ã‚Œã‚‹ãŸã‚ã€Core Web Vitalsã®CLSã‚’ä½ã„ã‚¹ã‚³ã‚¢ã«æŠ‘ãˆã‚‰ã‚Œãã†ã§ã™ã€‚

Nuxtã§ç”»åƒã‚’é…å»¶èª­ã¿è¾¼ã¿ã™ã‚‹éš›ã¯ã“ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã™ã‚‹ã ã‘ã§äº‹è¶³ã‚Šãã†ã§ã™ã­ğŸ‘
